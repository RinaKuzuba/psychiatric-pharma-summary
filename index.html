<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼è‡ªå‹•è³ªå•ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .security-notice {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
        }

        .progress-container {
            padding: 20px 30px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .progress-bar {
            background: #e9ecef;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(135deg, #667eea, #764ba2);
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-text {
            margin-top: 10px;
            font-size: 14px;
            color: #6c757d;
            display: flex;
            justify-content: space-between;
        }

        .timer-container {
            padding: 10px 30px;
            background: #fff3cd;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .timer-bar {
            flex: 1;
            background: #e9ecef;
            height: 6px;
            border-radius: 3px;
            margin-left: 15px;
            overflow: hidden;
        }

        .timer-fill {
            background: #ffc107;
            height: 100%;
            border-radius: 3px;
            transition: width 10s linear;
        }

        .timer-text {
            font-size: 18px;
            font-weight: bold;
            color: #856404;
            min-width: 40px;
        }

        .question-container {
            padding: 40px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .question-category {
            color: #667eea;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-text {
            font-size: 24px;
            color: #333;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        .input-container {
            margin-top: 20px;
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .checkbox-item:hover {
            background: #e9ecef;
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            flex: 1;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-next {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-skip {
            background: #6c757d;
            color: white;
        }

        .btn-skip:hover {
            background: #5a6268;
        }

        .btn-pause {
            background: #ffc107;
            color: #333;
        }

        .btn-pause:hover {
            background: #e0a800;
        }

        .start-screen, .complete-screen {
            padding: 60px 40px;
            text-align: center;
        }

        .start-screen h2, .complete-screen h2 {
            font-size: 32px;
            color: #333;
            margin-bottom: 20px;
        }

        .start-screen p, .complete-screen p {
            font-size: 16px;
            color: #6c757d;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .btn-start {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            font-size: 20px;
            padding: 15px 40px;
        }

        .btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }

        .download-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-download {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(23, 162, 184, 0.4);
        }

        .btn-restart {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-restart:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .paused-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .paused-modal {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            animation: bounceIn 0.5s;
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .paused-modal h3 {
            font-size: 28px;
            color: #333;
            margin-bottom: 20px;
        }

        .btn-resume {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            margin-top: 20px;
        }

        .btn-resume:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(40, 167, 69, 0.4);
        }

        .hint-text {
            font-size: 14px;
            color: #6c757d;
            font-style: italic;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’Š è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼è‡ªå‹•ä½œæˆã‚·ã‚¹ãƒ†ãƒ </h1>
            <div class="security-notice">
                ğŸ”’ <strong>å®Œå…¨ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå‡¦ç†</strong><br>
                ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã•ã‚Œã€å¤–éƒ¨é€ä¿¡ã¯ä¸€åˆ‡ã‚ã‚Šã¾ã›ã‚“
            </div>
        </div>

        <!-- ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ -->
        <div id="startScreen" class="start-screen">
            <h2>è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼ï¼ˆç²¾ç¥ç§‘ç‰ˆï¼‰</h2>
            <p>
                ã“ã‚Œã‹ã‚‰ç´„60é …ç›®ã®è³ªå•ã‚’é †ç•ªã«è¡¨ç¤ºã—ã¾ã™ã€‚<br>
                å„è³ªå•ã«ã¯<strong>10ç§’ã®å›ç­”æ™‚é–“</strong>ãŒã‚ã‚Šã¾ã™ã€‚<br>
                æ™‚é–“å†…ã«å›ç­”ãŒãªã„å ´åˆã¯è‡ªå‹•çš„ã«æ¬¡ã¸é€²ã¿ã¾ã™ã€‚<br><br>
                â±ï¸ æ‰€è¦æ™‚é–“ï¼šç´„10åˆ†<br>
                ğŸ“ æœ€å¾Œã«CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½
            </p>
            <button class="btn-start" onclick="startQuestionnaire()">é–‹å§‹ã™ã‚‹</button>
        </div>

        <!-- è³ªå•ç”»é¢ -->
        <div id="questionScreen" style="display: none;">
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill" style="width: 0%"></div>
                </div>
                <div class="progress-text">
                    <span id="questionNumber">è³ªå• 1 / 60</span>
                    <span id="categoryName">åŸºæœ¬æƒ…å ±</span>
                </div>
            </div>

            <div class="timer-container">
                <span class="timer-text" id="timerText">10</span>
                <div class="timer-bar">
                    <div id="timerFill" class="timer-fill" style="width: 100%"></div>
                </div>
            </div>

            <div class="question-container">
                <div class="question-category" id="questionCategory">åŸºæœ¬æƒ…å ±</div>
                <div class="question-text" id="questionText">æ‚£è€…æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</div>
                <div class="input-container" id="inputContainer">
                    <!-- å‹•çš„ã«å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæŒ¿å…¥ã•ã‚Œã‚‹ -->
                </div>
                <div class="hint-text" id="hintText"></div>
                <div class="button-container">
                    <button class="btn-skip" onclick="skipQuestion()">ã‚¹ã‚­ãƒƒãƒ—</button>
                    <button class="btn-pause" onclick="pauseTimer()">ä¸€æ™‚åœæ­¢</button>
                    <button class="btn-next" onclick="nextQuestion()">æ¬¡ã¸</button>
                </div>
            </div>
        </div>

        <!-- å®Œäº†ç”»é¢ -->
        <div id="completeScreen" style="display: none;">
            <div class="complete-screen">
                <h2>âœ… å…¥åŠ›å®Œäº†</h2>
                <p>
                    ã™ã¹ã¦ã®è³ªå•ã¸ã®å›ç­”ãŒå®Œäº†ã—ã¾ã—ãŸã€‚<br>
                    ä¸‹è¨˜ã®ãƒœã‚¿ãƒ³ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚
                </p>
                <div class="download-buttons">
                    <button class="btn-download" onclick="downloadCSV()">ğŸ“Š CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn-download" onclick="downloadJSON()">ğŸ“„ JSONå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn-download" onclick="downloadText()">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button class="btn-restart" onclick="location.reload()">ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
                </div>
            </div>
        </div>

        <!-- ä¸€æ™‚åœæ­¢ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div id="pausedOverlay" class="paused-overlay">
            <div class="paused-modal">
                <h3>â¸ï¸ ä¸€æ™‚åœæ­¢ä¸­</h3>
                <p>æº–å‚™ãŒã§ããŸã‚‰ã€Œå†é–‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„</p>
                <button class="btn-resume" onclick="resumeTimer()">å†é–‹ã™ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // è³ªå•ãƒ‡ãƒ¼ã‚¿
        const questions = [
            // åŸºæœ¬æƒ…å ±
            { category: "åŸºæœ¬æƒ…å ±", field: "patientName", question: "æ‚£è€…æ°åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "text", hint: "ãµã‚ŠãŒãªã‚‚å¿…è¦ãªå ´åˆã¯åˆ¥é€”å…¥åŠ›" },
            { category: "åŸºæœ¬æƒ…å ±", field: "patientId", question: "æ‚£è€…IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "text" },
            { category: "åŸºæœ¬æƒ…å ±", field: "admissionDate", question: "å…¥é™¢æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„", type: "date" },
            { category: "åŸºæœ¬æƒ…å ±", field: "dischargeDate", question: "é€€é™¢æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„", type: "date" },
            { category: "åŸºæœ¬æƒ…å ±", field: "gender", question: "æ€§åˆ¥ã‚’é¸æŠã—ã¦ãã ã•ã„", type: "select", options: ["ç”·æ€§", "å¥³æ€§", "ãã®ä»–"] },
            { category: "åŸºæœ¬æƒ…å ±", field: "birthDate", question: "ç”Ÿå¹´æœˆæ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„", type: "date" },
            { category: "åŸºæœ¬æƒ…å ±", field: "doctor", question: "æ‹…å½“åŒ»ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "text" },
            { category: "åŸºæœ¬æƒ…å ±", field: "pharmacist", question: "æ‹…å½“è–¬å‰¤å¸«ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "text" },
            { category: "åŸºæœ¬æƒ…å ±", field: "height", question: "èº«é•·(cm)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "number", hint: "ä¾‹: 165" },
            { category: "åŸºæœ¬æƒ…å ±", field: "weight", question: "ä½“é‡(kg)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "number", hint: "ä¾‹: 60" },
            { category: "åŸºæœ¬æƒ…å ±", field: "smoking", question: "å–«ç…™æ­´ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", type: "select", options: ["ãªã—", "ã‚ã‚Šï¼ˆç¾åœ¨ï¼‰", "ã‚ã‚Šï¼ˆéå»ï¼‰"] },
            { category: "åŸºæœ¬æƒ…å ±", field: "drinking", question: "é£²é…’æ­´ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", type: "select", options: ["ãªã—", "ã‚ã‚Šï¼ˆç¾åœ¨ï¼‰", "ã‚ã‚Šï¼ˆéå»ï¼‰"] },
            
            // ç—…æ­´æƒ…å ±
            { category: "ç—…æ­´æƒ…å ±", field: "mainDiagnosis", question: "ä¸»ç—…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "text" },
            { category: "ç—…æ­´æƒ…å ±", field: "medicalHistory", question: "æ—¢å¾€æ­´ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", type: "textarea", hint: "è¤‡æ•°ã‚ã‚‹å ´åˆã¯æ”¹è¡Œã§åŒºåˆ‡ã£ã¦å…¥åŠ›" },
            { category: "ç—…æ­´æƒ…å ±", field: "admissionReason", question: "å…¥é™¢ç†ç”±ã‚’é¸æŠã—ã¦ãã ã•ã„", type: "select", options: ["ç—…çŠ¶æ‚ªåŒ–", "æ€ è–¬ã«ã‚ˆã‚‹ç—…çŠ¶æ‚ªåŒ–", "é€šé™¢ä¸­æ–­ã«ã‚ˆã‚‹ç—…çŠ¶æ‚ªåŒ–", "å‰¯ä½œç”¨", "åˆç™º", "ãã®ä»–"] },
            { category: "ç—…æ­´æƒ…å ±", field: "admissionReasonOther", question: "ãã®ä»–ã®å…¥é™¢ç†ç”±ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰", type: "text", hint: "å‰å•ã§ã€Œãã®ä»–ã€ã‚’é¸æŠã—ãŸå ´åˆã«å…¥åŠ›" },
            
            // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãƒ»å‰¯ä½œç”¨æ­´
            { category: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±", field: "allergyHistory", question: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æ­´ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", type: "select", options: ["ãªã—", "ã‚ã‚Š", "ç–‘ã„"] },
            { category: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±", field: "allergyDetails", question: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®è©³ç´°ï¼ˆã‚ã‚‹å ´åˆï¼‰", type: "text", hint: "è–¬å‰¤åã‚„ç—‡çŠ¶ã‚’å…¥åŠ›" },
            { category: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±", field: "sideEffectHistory", question: "å‰¯ä½œç”¨æ­´ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", type: "select", options: ["ãªã—", "ã‚ã‚Š", "ç–‘ã„"] },
            { category: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æƒ…å ±", field: "sideEffectDetails", question: "å‰¯ä½œç”¨ã®è©³ç´°ï¼ˆã‚ã‚‹å ´åˆï¼‰", type: "text", hint: "è–¬å‰¤åã‚„ç—‡çŠ¶ã‚’å…¥åŠ›" },
            
            // æœè–¬ç®¡ç†æƒ…å ±
            { category: "æœè–¬ç®¡ç†", field: "priorMedicationManager", question: "å…¥é™¢å‰ã®æœè–¬ç®¡ç†è€…", type: "select", options: ["æœ¬äººç®¡ç†", "å®¶æ—ç®¡ç†", "ãã®ä»–"] },
            { category: "æœè–¬ç®¡ç†", field: "priorManagementMethod", question: "å…¥é™¢å‰ã®ç®¡ç†æ–¹æ³•", type: "select", options: ["ãã®ã¾ã¾", "ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼", "ãƒœãƒƒã‚¯ã‚¹", "ãƒ•ã‚¡ã‚¤ãƒ«", "ãã®ä»–"] },
            { category: "æœè–¬ç®¡ç†", field: "postMedicationManager", question: "é€€é™¢å¾Œã®æœè–¬ç®¡ç†è€…", type: "select", options: ["æœ¬äºº", "å®¶æ—", "åŒ»ç™‚å¾“äº‹è€…", "ãã®ä»–"] },
            { category: "æœè–¬ç®¡ç†", field: "dischargeDestination", question: "é€€é™¢å…ˆ", type: "select", options: ["å½“é™¢", "ä»–é™¢", "è‡ªå®…", "æ–½è¨­"] },
            
            // å…¥é™¢æ™‚æŒå‚è–¬
            { category: "æŒå‚è–¬", field: "broughtMedications", question: "å…¥é™¢æ™‚æŒå‚è–¬ã¯ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ", type: "select", options: ["ã‚ã‚Š", "ãªã—"] },
            { category: "æŒå‚è–¬", field: "prescribingInstitution", question: "å‡¦æ–¹åŒ»ç™‚æ©Ÿé–¢", type: "text", hint: "æŒå‚è–¬ãŒã‚ã‚‹å ´åˆ" },
            { category: "æŒå‚è–¬", field: "medicationInfoSource", question: "è–¬å‰¤æƒ…å ±ã®ç¢ºèªæ–¹æ³•", type: "checkbox", options: ["ãŠè–¬æ‰‹å¸³", "æ‰‹å¸³ã‚¢ãƒ—ãƒª", "ãƒã‚¤ãƒŠä¿é™ºè¨¼", "ç´¹ä»‹çŠ¶", "è–¬æƒ…"] },
            { category: "æŒå‚è–¬", field: "prescriptionDetails", question: "å‡¦æ–¹è–¬ã®è©³ç´°", type: "textarea", hint: "è–¬å‰¤åã€ç”¨æ³•ç”¨é‡ãªã©" },
            
            // æœè–¬çŠ¶æ³
            { category: "æœè–¬çŠ¶æ³", field: "priorAdherence", question: "å…¥é™¢å‰ã®æœè–¬çŠ¶æ³", type: "select", options: ["è‰¯å¥½", "é£²ã¿å¿˜ã‚Œ", "æ‹’è–¬å‚¾å‘", "ãã®ä»–"] },
            { category: "æœè–¬çŠ¶æ³", field: "hospitalAdherence", question: "å…¥é™¢ä¸­ã®æœè–¬çŠ¶æ³", type: "select", options: ["è‰¯å¥½", "é£²ã¿å¿˜ã‚Œ", "æ‹’è–¬å‚¾å‘", "ãã®ä»–"] },
            { category: "æœè–¬çŠ¶æ³", field: "administrationRoute", question: "è–¬å‰¤æŠ•ä¸æ–¹æ³•", type: "select", options: ["çµŒå£ï¼ˆæ™®é€šéŒ ï¼‰", "çµŒå£ï¼ˆç²‰ç •ï¼‰", "çµŒç®¡ï¼ˆç²‰ç •ï¼‰", "çµŒç®¡ï¼ˆç°¡æ˜“æ‡¸æ¿æ³•ï¼‰"] },
            { category: "æœè–¬çŠ¶æ³", field: "dispensingMethod", question: "å…¥é™¢ä¸­ã®èª¿å‰¤æ–¹æ³•", type: "select", options: ["æ—¥ä»˜ã‚ã‚Šä¸€åŒ…åŒ–", "æ—¥ä»˜ãªã—ä¸€åŒ…åŒ–", "ãã®ä»–"] },
            
            // æœè–¬ã‚¢ãƒ‰ãƒ’ã‚¢ãƒ©ãƒ³ã‚¹
            { category: "ã‚¢ãƒ‰ãƒ’ã‚¢ãƒ©ãƒ³ã‚¹", field: "refusalReason", question: "æ‹’è–¬ãƒ»æ€ è–¬ã®ç†ç”±", type: "checkbox", options: [
                "æ¯æ—¥è–¬ã‚’é£²ã‚€ã®ãŒé¢å€’",
                "è–¬ã‚’é£²ã‚€ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒé›£ã—ã„",
                "äººå‰ã§è–¬ã‚’é£²ã‚€ã“ã¨ã«æŠµæŠ—",
                "å®¶æ—ã®æœè–¬ç¢ºèªã«æŠµæŠ—",
                "è–¬ã®é‡ã‚’è‡ªåˆ†ã§èª¿ç¯€",
                "è–¬ã‚’é£²ã‚€é‡ãŒå¤šã„",
                "è–¬ã‚’é£²ã‚€å›æ•°ãŒå¤šã„",
                "é£²ã¿é–“é•ãˆã¦ã—ã¾ã†",
                "å‰¯ä½œç”¨ãŒã‚ã‚‹",
                "åŠ¹æœã‚’æ„Ÿã˜ãªã„",
                "å†ç™ºã—ãªã„ã¨æ€ã†",
                "æ´»å‹•ã‚’æ§ãˆã‚‹å¿…è¦",
                "ç—…æ°—ã®èªè­˜ä¸è¶³"
            ]},
            { category: "ã‚¢ãƒ‰ãƒ’ã‚¢ãƒ©ãƒ³ã‚¹", field: "sideEffectTypes", question: "çµŒé¨“ã—ãŸå‰¯ä½œç”¨", type: "checkbox", options: [
                "å–‰ã®æ¸‡ã",
                "çœ æ°—",
                "ä¾¿ç§˜",
                "é ­ãŒã¼ãƒ¼ã£ã¨ã™ã‚‹",
                "æ‰‹ã®éœ‡ãˆ",
                "ä½“é‡å¢—åŠ ",
                "ç”Ÿç†ä¸é †",
                "ãã®ä»–"
            ]},
            
            // ç²¾ç¥ç§‘è–¬å‰¤
            { category: "ç²¾ç¥ç§‘è–¬å‰¤", field: "medicationChanges", question: "è–¬å‰¤å¤‰æ›´ã¯ã‚ã‚Šã¾ã—ãŸã‹ï¼Ÿ", type: "select", options: ["ã‚ã‚Š", "ãªã—"] },
            { category: "ç²¾ç¥ç§‘è–¬å‰¤", field: "changeType1", question: "å¤‰æ›´å†…å®¹1", type: "select", options: ["é–‹å§‹", "å¢—é‡", "æ¸›é‡", "ä¸­æ­¢", "å¤‰æ›´", "ãªã—"] },
            { category: "ç²¾ç¥ç§‘è–¬å‰¤", field: "changeDrug1", question: "å¤‰æ›´è–¬å‰¤å1", type: "text", hint: "å¤‰æ›´ãŒã‚ã£ãŸå ´åˆ" },
            { category: "ç²¾ç¥ç§‘è–¬å‰¤", field: "changeReason1", question: "å¤‰æ›´ç†ç”±1", type: "select", options: ["åŠ¹æœä¸ååˆ†", "å‰¯ä½œç”¨", "æ‚£è€…å¸Œæœ›", "æ‹’è–¬", "ãã®ä»–"] },
            { category: "ç²¾ç¥ç§‘è–¬å‰¤", field: "sustainedInjection", question: "æŒåŠ¹æ€§æ³¨å°„å‰¤ã®ä½¿ç”¨", type: "select", options: ["ã‚ã‚Š", "ãªã—"] },
            { category: "ç²¾ç¥ç§‘è–¬å‰¤", field: "injectionDetails", question: "æŒåŠ¹æ€§æ³¨å°„å‰¤ã®è©³ç´°", type: "text", hint: "è–¬å‰¤åã€ç”¨é‡ã€æœ€çµ‚æŠ•ä¸æ—¥ãªã©" },
            
            // DIEPSSè©•ä¾¡
            { category: "DIEPSSè©•ä¾¡", field: "diepssGait", question: "DIEPSSè©•ä¾¡ï¼šæ­©è¡Œ", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssBradykinesia", question: "DIEPSSè©•ä¾¡ï¼šå‹•ä½œç·©æ…¢", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssSialorrhea", question: "DIEPSSè©•ä¾¡ï¼šæµæ¶", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssRigidity", question: "DIEPSSè©•ä¾¡ï¼šç­‹å¼·å‰›", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssTremor", question: "DIEPSSè©•ä¾¡ï¼šæŒ¯æˆ¦", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssAkathisia", question: "DIEPSSè©•ä¾¡ï¼šã‚¢ã‚«ã‚·ã‚¸ã‚¢", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssDystonia", question: "DIEPSSè©•ä¾¡ï¼šã‚¸ã‚¹ãƒˆãƒ‹ã‚¢", type: "select", options: ["0", "1", "2", "3", "4"] },
            { category: "DIEPSSè©•ä¾¡", field: "diepssDyskinesia", question: "DIEPSSè©•ä¾¡ï¼šã‚¸ã‚¹ã‚­ãƒã‚¸ã‚¢", type: "select", options: ["0", "1", "2", "3", "4"] },
            
            // æ¤œæŸ»å€¤
            { category: "æ¤œæŸ»å€¤", field: "ast", question: "ASTå€¤ (IU/L)", type: "number", hint: "æœ€æ–°ã®æ¤œæŸ»å€¤" },
            { category: "æ¤œæŸ»å€¤", field: "alt", question: "ALTå€¤ (IU/L)", type: "number", hint: "æœ€æ–°ã®æ¤œæŸ»å€¤" },
            { category: "æ¤œæŸ»å€¤", field: "ggt", question: "Î³-GTPå€¤ (IU/L)", type: "number", hint: "æœ€æ–°ã®æ¤œæŸ»å€¤" },
            { category: "æ¤œæŸ»å€¤", field: "scr", question: "SCrå€¤ (mg/dl)", type: "number", hint: "æœ€æ–°ã®æ¤œæŸ»å€¤" },
            { category: "æ¤œæŸ»å€¤", field: "egfr", question: "eGFRå€¤ (mL/min/1.73m2)", type: "number", hint: "æœ€æ–°ã®æ¤œæŸ»å€¤" },
            { category: "æ¤œæŸ»å€¤", field: "regularTestDrugs", question: "å®šæœŸæ¤œæŸ»ãŒå¿…è¦ãªè–¬å‰¤", type: "text", hint: "è–¬å‰¤åã¨æœ€çµ‚æ¤œæŸ»æ—¥" },
            
            // çµŒéãƒ»ç”³ã—é€ã‚Š
            { category: "çµŒéãƒ»ç”³ã—é€ã‚Š", field: "treatmentProgress", question: "å…¥é™¢ä¸­ã®è–¬ç‰©æ²»ç™‚çµŒé", type: "textarea", hint: "é‡è¦ãªçµŒéã‚’è¨˜å…¥" },
            { category: "çµŒéãƒ»ç”³ã—é€ã‚Š", field: "patientProblems", question: "æ‚£è€…ã®å•é¡Œç‚¹", type: "textarea", hint: "æœè–¬ã«é–¢ã™ã‚‹å•é¡Œãªã©" },
            { category: "çµŒéãƒ»ç”³ã—é€ã‚Š", field: "interventions", question: "æœè–¬æŒ‡å°ãƒ»ä»‹å…¥ã®è¦ç‚¹", type: "textarea" },
            { category: "çµŒéãƒ»ç”³ã—é€ã‚Š", field: "postDischargeProblems", question: "é€€é™¢å¾Œã®å•é¡Œç‚¹", type: "textarea" },
            { category: "çµŒéãƒ»ç”³ã—é€ã‚Š", field: "handoverNotes", question: "ä»–åŒ»ç™‚æ©Ÿé–¢ã¸ã®ç”³ã—é€ã‚Šäº‹é …", type: "textarea", hint: "é‡è¦ãªæ³¨æ„äº‹é …ãªã©" }
        ];

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentQuestionIndex = 0;
        let answers = {};
        let timer = null;
        let timeRemaining = 10;
        let isPaused = false;

        // è³ªå•é–‹å§‹
        function startQuestionnaire() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('questionScreen').style.display = 'block';
            showQuestion(0);
        }

        // è³ªå•è¡¨ç¤º
        function showQuestion(index) {
            if (index >= questions.length) {
                completeQuestionnaire();
                return;
            }

            const q = questions[index];
            currentQuestionIndex = index;

            // é€²æ—æ›´æ–°
            const progress = ((index + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('questionNumber').textContent = `è³ªå• ${index + 1} / ${questions.length}`;
            document.getElementById('categoryName').textContent = q.category;
            
            // è³ªå•è¡¨ç¤º
            document.getElementById('questionCategory').textContent = q.category;
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('hintText').textContent = q.hint || '';

            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ç”Ÿæˆ
            const inputContainer = document.getElementById('inputContainer');
            inputContainer.innerHTML = '';

            if (q.type === 'text' || q.type === 'number' || q.type === 'date') {
                const input = document.createElement('input');
                input.type = q.type;
                input.id = 'currentInput';
                input.value = answers[q.field] || '';
                inputContainer.appendChild(input);
                setTimeout(() => input.focus(), 100);
            } else if (q.type === 'textarea') {
                const textarea = document.createElement('textarea');
                textarea.id = 'currentInput';
                textarea.value = answers[q.field] || '';
                inputContainer.appendChild(textarea);
                setTimeout(() => textarea.focus(), 100);
            } else if (q.type === 'select') {
                const select = document.createElement('select');
                select.id = 'currentInput';
                
                const defaultOption = document.createElement('option');
                defaultOption.value = '';
                defaultOption.textContent = 'é¸æŠã—ã¦ãã ã•ã„';
                select.appendChild(defaultOption);
                
                q.options.forEach(opt => {
                    const option = document.createElement('option');
                    option.value = opt;
                    option.textContent = opt;
                    if (answers[q.field] === opt) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
                
                inputContainer.appendChild(select);
                setTimeout(() => select.focus(), 100);
            } else if (q.type === 'checkbox') {
                const checkboxGroup = document.createElement('div');
                checkboxGroup.className = 'checkbox-group';
                
                const currentValues = answers[q.field] ? answers[q.field].split(',') : [];
                
                q.options.forEach((opt, i) => {
                    const item = document.createElement('div');
                    item.className = 'checkbox-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `checkbox_${i}`;
                    checkbox.value = opt;
                    checkbox.checked = currentValues.includes(opt);
                    
                    const label = document.createElement('label');
                    label.htmlFor = `checkbox_${i}`;
                    label.textContent = opt;
                    
                    item.appendChild(checkbox);
                    item.appendChild(label);
                    checkboxGroup.appendChild(item);
                });
                
                inputContainer.appendChild(checkboxGroup);
            }

            // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
            startTimer();
        }

        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        function startTimer() {
            timeRemaining = 10;
            isPaused = false;
            updateTimerDisplay();
            
            if (timer) clearInterval(timer);
            
            timer = setInterval(() => {
                if (!isPaused) {
                    timeRemaining--;
                    updateTimerDisplay();
                    
                    if (timeRemaining <= 0) {
                        clearInterval(timer);
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        // ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤ºæ›´æ–°
        function updateTimerDisplay() {
            document.getElementById('timerText').textContent = timeRemaining;
            const percentage = (timeRemaining / 10) * 100;
            document.getElementById('timerFill').style.width = percentage + '%';
            document.getElementById('timerFill').style.transition = isPaused ? 'none' : 'width 1s linear';
        }

        // ä¸€æ™‚åœæ­¢
        function pauseTimer() {
            isPaused = true;
            clearInterval(timer);
            document.getElementById('pausedOverlay').style.display = 'flex';
        }

        // å†é–‹
        function resumeTimer() {
            document.getElementById('pausedOverlay').style.display = 'none';
            isPaused = false;
            
            timer = setInterval(() => {
                if (!isPaused) {
                    timeRemaining--;
                    updateTimerDisplay();
                    
                    if (timeRemaining <= 0) {
                        clearInterval(timer);
                        nextQuestion();
                    }
                }
            }, 1000);
        }

        // æ¬¡ã®è³ªå•ã¸
        function nextQuestion() {
            saveCurrentAnswer();
            clearInterval(timer);
            showQuestion(currentQuestionIndex + 1);
        }

        // ã‚¹ã‚­ãƒƒãƒ—
        function skipQuestion() {
            clearInterval(timer);
            showQuestion(currentQuestionIndex + 1);
        }

        // ç¾åœ¨ã®å›ç­”ã‚’ä¿å­˜
        function saveCurrentAnswer() {
            const q = questions[currentQuestionIndex];
            
            if (q.type === 'checkbox') {
                const checkboxes = document.querySelectorAll('#inputContainer input[type="checkbox"]:checked');
                const values = Array.from(checkboxes).map(cb => cb.value);
                if (values.length > 0) {
                    answers[q.field] = values.join(',');
                }
            } else {
                const input = document.getElementById('currentInput');
                if (input && input.value) {
                    answers[q.field] = input.value;
                }
            }
        }

        // å®Œäº†å‡¦ç†
        function completeQuestionnaire() {
            clearInterval(timer);
            document.getElementById('questionScreen').style.display = 'none';
            document.getElementById('completeScreen').style.display = 'block';
        }

        // CSVä½œæˆ
        function generateCSV() {
            const headers = ['é …ç›®å', 'å›ç­”'];
            const rows = [headers];
            
            questions.forEach(q => {
                const answer = answers[q.field] || 'æœªå›ç­”';
                rows.push([q.question, answer]);
            });
            
            // æ—¥æœ¬èªå¯¾å¿œã®ãŸã‚BOMä»˜ãUTF-8
            const BOM = '\uFEFF';
            const csvContent = BOM + rows.map(row => 
                row.map(cell => {
                    // ã‚»ãƒ«å†…ã«æ”¹è¡Œã€ã‚«ãƒ³ãƒã€ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆãŒå«ã¾ã‚Œã‚‹å ´åˆã®å‡¦ç†
                    if (typeof cell === 'string' && (cell.includes(',') || cell.includes('"') || cell.includes('\n'))) {
                        return '"' + cell.replace(/"/g, '""') + '"';
                    }
                    return cell;
                }).join(',')
            ).join('\n');
            
            return csvContent;
        }

        // CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadCSV() {
            const csv = generateCSV();
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadJSON() {
            const data = {
                ä½œæˆæ—¥æ™‚: new Date().toLocaleString('ja-JP'),
                å›ç­”ãƒ‡ãƒ¼ã‚¿: answers,
                å…¨è³ªå•: questions.map(q => ({
                    ã‚«ãƒ†ã‚´ãƒª: q.category,
                    è³ªå•: q.question,
                    ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: q.field,
                    å›ç­”: answers[q.field] || 'æœªå›ç­”'
                }))
            };
            
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ãƒ†ã‚­ã‚¹ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        function downloadText() {
            let text = 'è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼ï¼ˆç²¾ç¥ç§‘ç‰ˆï¼‰\n';
            text += '=' + '='.repeat(50) + '\n\n';
            text += `ä½œæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}\n\n`;
            
            let currentCategory = '';
            questions.forEach(q => {
                if (currentCategory !== q.category) {
                    currentCategory = q.category;
                    text += '\nã€' + currentCategory + 'ã€‘\n';
                    text += '-'.repeat(40) + '\n';
                }
                
                const answer = answers[q.field] || 'æœªå›ç­”';
                text += `${q.question}:\n  ${answer}\n\n`;
            });
            
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è–¬å‰¤ç®¡ç†ã‚µãƒãƒªãƒ¼_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Enterã‚­ãƒ¼ã§æ¬¡ã¸
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('questionScreen').style.display !== 'none') {
                if (!isPaused) {
                    nextQuestion();
                }
            }
        });

        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®è­¦å‘Š
        window.addEventListener('beforeunload', function(e) {
            if (Object.keys(answers).length > 0 && document.getElementById('completeScreen').style.display === 'none') {
                e.preventDefault();
                e.returnValue = 'å…¥åŠ›ä¸­ã®ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã¾ã™ã€‚æœ¬å½“ã«ãƒšãƒ¼ã‚¸ã‚’é›¢ã‚Œã¾ã™ã‹ï¼Ÿ';
            }
        });
    </script>
